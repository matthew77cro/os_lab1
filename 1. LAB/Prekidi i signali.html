
<!-- saved from url=(0070)http://zemris.fer.hr/predmeti/os/pripreme/upute/prekidi_i_signali.html -->
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1250">

<meta name="ProgId" content="FrontPage.Editor.Document">
<meta name="Generator" content="Microsoft FrontPage 6.0">
<meta name="Originator" content="Microsoft Word 9">
<link rel="Edit-Time-Data" href="http://zemris.fer.hr/predmeti/os/pripreme/upute/vj1_files/editdata.mso">
<title>Prekidi i signali</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>marin</o:Author>
  <o:LastAuthor>marin</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>0</o:TotalTime>
  <o:Created>2002-02-25T16:16:00Z</o:Created>
  <o:LastSaved>2002-02-25T16:16:00Z</o:LastSaved>
  <o:Pages>4</o:Pages>
  <o:Words>1407</o:Words>
  <o:Characters>8021</o:Characters>
  <o:Company>ZEMRIS</o:Company>
  <o:Lines>66</o:Lines>
  <o:Paragraphs>16</o:Paragraphs>
  <o:CharactersWithSpaces>9850</o:CharactersWithSpaces>
  <o:Version>9.4402</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman"; margin-left:0cm; margin-right:0cm; margin-top:0cm}
p
	{font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";}
tt
	{mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:657073330;
	mso-list-type:hybrid;
	mso-list-template-ids:318936324 737303090 -1124678694 1029613940 1318385614 650958560 -70341020 -717179694 -1799589596 -603937172;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<meta name="Author" content="Marin&amp;Goc">
<meta name="Description" content="Operacijski sustavi I, 1. vježba">
</head>

<body lang="EN-GB" style="">

<div class="Section1">

<div class="MsoNormal" align="center" style="text-align:center">

</div>


<h1> PREKIDI I SIGNALI</h1>
<h3> Upute za laboratorijske vježbe</h3>


<div class="MsoNormal" align="center" style="text-align:center">

<hr size="1" width="100%" align="center">

</div>


<h2><span lang="hr">SIGNALI</span></h2>

<p><span lang="hr">Signali na razini procesa (pokrenutog programa) su analogni 
mehanizam sklopovskim prekidima na razini procesora. Služe za obradu nekih 
asinkronih dogaðaja. Osnovna ideja je kao i kod prekida: proces nešto svoje radi 
dok se u nekom (neoèekivanom) trenutku ne dogodi nešto što treba odmah obraditi. 
Stoga se pri primitku signala trenutni posao prekida, obraðuje se signal, te 
nastavlja s prekinutim poslom. Signal ne sadrži dodatne informacije (osim broja 
signala) - ako su one potrebne, treba ih dohvatiti u obradi signala. Signal 
procesu može poslati jezgra operacijska sustava (npr. SIGSEGV), drugi proces (npr. 
SIGTERM) ili proces sam sebi (npr. SIGALRM uz odgodu ili neki drugi dogaðaj). 
Proces može programirati svoje ponašanje za signal: - može ga prihvatiti i 
obraditi pretpostavljenom funkcijom (veæinom to znaèi prekid procesa) - može ga 
prihvatiti i obraditi funkcijom zadanom u programu (u programu je definirano što 
æe se obaviti po primitku takvog signala) - može ga se zadržati (zapamtiti, ali 
ne i odmah obraditi) - može ga se ignorirati (odbaciti bez obrade). Izuzetak od 
navedenih pravila je SIGKILL koji ubija proces (SIGKILL ignorira postavke koje 
je program postavio).&nbsp; </span></p>
<p>Kada se prihvati signal, pozove se funkcija za obradu signala. Slièno kao i 
kod prekida na razini procesora, i pri prihvatu signala zabranjuje se daljnje 
prekidanje, ali samo s tim signalom - drugi signali mogu prekinuti tu obradu. Po 
završektu obrade ponovno se dozvoljava prekidanje s tim signalom te se 
eventualno zadržani signali (došli za vrijeme obrade) sada propuštaju. Signali 
koji se procesu upute za vrijeme obrade prethodnog signala istog tipa - isti 
broj, stavljaju se u red i èekaju. S time da se pamti samo po jedan signal istog 
tipa. Primjerice, ako procesu za vrijeme obrade signala SIGINT doðu još tri 
takva signala, zapamtit æe se samo prvi takav signal. Po završetku obrade prvog 
signala SIGINT ponovno æe se pozvati ista funkcija, ali samo jednom (uz 
prepostavku da za vrijeme ove druge obrade nije došao novi signal SIGINT). </p>
<p>Signali su standardni mehanizam na UNIX operacijskim sustavima i njemu 
sliènim (npr. Linux). Operacijski sustavi Windows imaju minimalnu podršku za 
signale i u mnogoèemu su razlièiti (zapravo se oni ne koriste).</p>
<span lang="hr">

<h3>Signali i suèelja za upravljanje signalima</h3>

<p>Moderne implementacije UNIX-a definiraju oko tridesetak signala. Ovdje je
pregled samo istaknutijih signala, dok potpun popis daje <tt><span style="font-size:
10.0pt;font-family:&quot;Courier New&quot;">
<a href="http://www.opengroup.org/onlinepubs/009695399/basedefs/signal.h.html">man 
-s 3HEAD signal</a></span></tt>:</p>

<div align="center">

<table border="0" cellpadding="0" style="mso-cellspacing:1.5pt">
 <tbody><tr>
  <td width="20%" style="width:20.0%;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal"><tt><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SIGINT
  (2)</span></tt></p>
  </td>
  <td width="477" style="width:357.75pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal">(<i>interrupt</i>) "prekid", može ga se poslati programu sa
	<span lang="hr"> <tt><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Ctrl-C</span></b></tt></span></p>
  </td>
 </tr>
 <tr>
  <td width="140" style="width:105.0pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal"><tt><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SIGQUIT
  (3)</span></tt></p>
  </td>
  <td width="477" style="width:357.75pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal">(<i>quit</i>) "završi (zbog nekih problema) može ga se 
	poslati programu sa <tt><b>
	<span style="font-size: 10.0pt; font-family: Courier New">Ctrl+\</span></b></tt><span lang="hr"> 
	(na nekim HR tipkovnicama sa </span><tt><b>
	<span style="font-size: 10.0pt; font-family: Courier New">Ctrl+Ž</span></b></tt><span lang="hr">)</span></p>
  </td>
 </tr>
 <tr>
  <td width="140" style="width:105.0pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal"><tt><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SIGALRM
  (14)</span></tt></p>
  </td>
  <td width="477" style="width:357.75pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal">(<i>alarm</i>) koristi se prilikom korištenja funkcije 
	sleep</p>
  </td>
 </tr>
	<tr>
  <td width="140" style="width:105.0pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal"><tt><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SIGTERM
  (15)</span></tt></p>
  </td>
  <td width="477" style="width:357.75pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal">(<i>terminate</i>) traži se od procesa da završi s radom 
	(na redoviti naèin)</p>
  </td>
 </tr>
 <tr>
  <td width="140" style="width:105.0pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal"><tt><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">
	SIGKILL (9)</span></tt></p>
  </td>
  <td width="477" style="width:357.75pt;padding:.75pt .75pt .75pt .75pt">
  <p class="MsoNormal">(<i>kill</i>) traži se od operacijskog sustava da prekine 
	navedeni proces kome se signal šalje</p>
  </td>
 </tr>
 </tbody></table>

</div>

</span>

<p><span lang="hr">Simbolièka imena signala nalaze se u biblioteci <tt><span style="font-size:10.0pt;
font-family:&quot;Courier New&quot;">
<a href="http://www.opengroup.org/onlinepubs/009695399/basedefs/signal.h.html">signal.h</a></span></tt>.</span></p>
<p>U nastavku su prikazane "starije" i jednostavnije funkcije za rad sa 
signalima (upravo zato jer su jednostavnije). Meðutim, pri "ozbiljnom" 
korištenju signala treba razmotriti korištenje modernija sucelja (sigaction, 
pthread_kill, pthread_sigmask).<br>
&nbsp;</p><span lang="hr">
<h3>Funkcija <i>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/sighold.html">
sigset</a></i>(<i> signal</i>, <i>obrada_signala </i>)</h3>

<p>Funkcija definira što ce se zbiti prilikom primitka odreðenog signala 
(maskira signal). Argument <i>signal</i> je broj signala (npr. SIGINT). Drugi 
argument je kazaljka na funkciju i može biti:</p>
<ul type="disc">
 <li class="MsoNormal" style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo1;tab-stops:list 36.0pt"><tt>
	<span style="font-size:
     10.0pt;font-family:&quot;Courier New&quot;">SIG_DFL</span> </tt>- (<i>default</i>) 
	pretpostavljeno ponašanje za taj signal (za vecinu signala to znaci 
	uništavanje procesa)</li>
 <li class="MsoNormal" style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo1;tab-stops:list 36.0pt"><tt><span style="font-size:
     10.0pt;font-family:&quot;Courier New&quot;">SIG_IGN </span></tt>- (<i>ignore</i>) 
	ignoriranje signala</li>
 <li class="MsoNormal" style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo1;tab-stops:list 36.0pt"><tt><span style="font-size:
     10.0pt;font-family:&quot;Courier New&quot;">SIG_HOLD </span></tt>- (hold) signal se 
	zapamti, ali ne obraduje odmah - obradit ce se onda kada se definicija 
	ponašanja za taj signal promijeni (npr. kasniji poziv sigset)</li>
 <li class="MsoNormal" style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo1;tab-stops:list 36.0pt"><tt><span style="font-size:
     10.0pt;font-family:&quot;Courier New&quot;">obrada_signala</span></tt> - kazaljka<span lang="hr"> na funkciju 
	za obradu signala.</span></li>
</ul>

<p>Funkcija <tt>
<span style="font-size: 10.0pt; font-family: Courier New">sigset</span></tt><span lang="hr"> 
vraæa prethodno ponašanje procesa za navedeni signal (ili adresu funkcije kojom 
se signal obraðivao).</span></p></span>
<pre>void obrada_signala( int signal );</pre>
<span lang="hr">
<p>Funkcija za obradu signala treba primiti (minimalno) jedan parametar - broj 
signala, po kojem se u funkciji može odrediti koji je signal uzrok poziva te 
funkcije.</p>
<h3>Funkcije <i>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/sighold.html">
sighold</a></i>( <i>signal</i> ) i <i>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/sighold.html">
sigrelse</a></i>( <i>signal</i> )</h3>
<p>Funkcijama <font face="Courier New" size="2">sighold</font> i 
<font face="Courier New" size="2">sigrelse</font><span lang="hr"> može se 
zabraniti, odnosno omoguæiti prekidanje nekim signalom.<br>
Primjerice, ako je potrebno jedan dio koda zaštiti od prekidanja nekim signalom, 
taj kod se može ograditi sa&nbsp; <font face="Courier New" size="2">sighold</font> 
i </span><font face="Courier New" size="2">sigrelse</font><span lang="hr">. 
Takoder, ako je u funkciji obrade signala potrebno ponovno dozvoliti prekidanje 
i unutar te funkcije, opet se mogu koristiti te funkcije.</span></p>
<h3><span lang="hr">Funkcija <i>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/kill.html">
kill</a></i>( <i>pid</i>, <i>signal</i> )</span></h3>
<p><span lang="hr">Funkcijom kill šalje se signal signal procesu s 
identifikacijskim brojem <i>pid</i>. <i>pid</i> procesa se može vidjeti i 
naredbom <i>ps</i>.<br>
U ljusci postoji istoimena naredba <i>kill</i> -<i>signal</i> <i>pid</i> koja 
radi isto (šalje signal procesu). Ukoliko treba ubiti neki proces može se to 
uèiniti naredbom <i>kill -SIGKILL pid (ili kill -9 pid)</i>.</span></p>
<h3><span lang="hr">Funkcija <i>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/pause.html">
pause</a></i>()</span></h3>
<p><span lang="hr">Funkcija zaustavlja rad procesa dok se njemu ne pošalje bilo 
koji signal. Po primitku signala, najprije se obraðuje taj signal, a potom 
nastavlja s programom koji slijedi iza pause.</span></p>
<h3><span lang="hr">Funkcija <i>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/alarm.html">
alarm</a></i>(<i> t </i>)</span></h3>
<p><span lang="hr">Funkcija <i>alarm(t)</i> programira alarm koji æe nakon <i>t</i> 
sekundi procesu poslati signal SIGALRM. Ako se alarm pozove prije nego li se 
prethodno postavljeni alarm aktivirao, prethodni se poništava (prepisuje se 
novim). Ako je <i>t=0</i>, prethodno postavljeni alarm (ako je bilo takvog) se 
poništava.</span></p>
<h3><span lang="hr">Funkcija
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/sleep.html">
sleep</a>( t )</span></h3>
<p><span lang="hr">Namjena funkcije <i>sleep(t)</i> je odgoditi izvoðenje 
programa za <i>t</i> sekundi. Medutim, funkcija æe biti prekinuta bilo kojim 
signalom te, nakon obrade pristiglog signala, program nastavlja nakon poziva <i>
sleep</i> (i odgoda æe u tom sluèaju biti kraæa), a povratna vrijednost æe biti 
broj "neprospavanih" sekundi.<br>
Primjerice, ako se 5 sekundi nakon poziva <i>sleep</i>(100) procesu pošalje neki 
signal (koji se brzo obradi), program æe nastaviti s izvoðenjem instrukcija 
nakon funkcije <i>sleep</i> veæ nakon tih 5 sekundi, tj. neæe spavati još 95 
nakon obrade signala! Meðutim, funkcija <i>sleep</i> æe vratiti vrijednost 95 pa 
se ta vrijednost može iskoristiti za dodatnu odgodu:</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">a = sleep(100);</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">while( (a = sleep( a )) &gt; 0 );</pre>
<p><span lang="hr">Odgoda s moguènošæu veæe preciznosti je funkcija <i>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/nanosleep.html">
nanosleep</a>(t)</i>. Postoji i funkcija <i>usleep(us)</i> (mikrosekunde), ali 
se njeno korištenje ne preporuèa (smatra se zastarjelom).</span></p>
<span lang="hr">

<p>Umjesto funkcije <font face="Courier New" size="2">sigset</font> može se 
koristiti i naprednija funckija <font face="Courier New" size="2">
<a href="http://www.opengroup.org/onlinepubs/007908799/xsh/sigaction.html">
sigaction</a></font>. Opis te funkcije dan je i kratkim <a href="http://zemris.fer.hr/predmeti/os/pripreme/upute/sigaction.c">
primjerom</a>. </p>
</span>
<p><span lang="hr">Kostur programa koji poziva zadanu funkciju prilikom primitka 
signala SIGINT dan je sljedecim kodom:</span></p>

<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">#include &lt;stdio.h&gt;</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">#include &lt;signal.h&gt;</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">&nbsp;</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">void prekidna_rutina(int sig)
{
<span style="mso-spacerun: yes">&nbsp;&nbsp; </span>/* <i>obrada prekida</i> */</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">}</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">int main (void)</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">{</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>sigset (SIGTSTP, prekidna_rutina);</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">&nbsp;</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">   printf("Poceo osnovni program PID=%d\n", getpid());
</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">&nbsp;</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>/* <i>troši vrijeme da se ima šta prekinuti - 10 s</i> */</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">&nbsp;</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>printf ("Zavrsio osnovni program\n");</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>return 0;</pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">}</pre>
</span></div>



</body></html>