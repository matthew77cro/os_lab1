
<!-- saved from url=(0050)http://zemris.fer.hr/predmeti/os/pripreme/z1a.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
<meta http-equiv="Content-Language" content="hr">

<title>Signali</title>
<style>
<!--
div.Section1
	{page:Section1;}
p
	{font-size:12.0pt;
	font-family:"Times New Roman";
	}
-->
</style>
</head>

<body style="">

<h2>Vježba 1: Signali</h2>
<h3>Zadatak</h3>

<span style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">
Raèunati proste brojeve te preko signala periodièki ispisivati status. Koristiti<span class="Apple-converted-space">&nbsp;</span></span><i style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">setitimer</i><span style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"><span class="Apple-converted-space">&nbsp;</span>suèelje 
za periodièki alarm (vidjeti Primjer periodièke obrade pri dnu stranice). Na 
signal SIGINT privremeno zaustaviti rad na iduæim brojevima (programski 
ostvariti zaustavljanje), odnosno, nastaviti s radom ako je program prethodno 
bio zaustavljen. Na signal SIGTERM ispisati zadnji broj koji se provjerava (ili 
æe biti iduæi) i završiti s radom.</span><p style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<a name="skica">Skica rješenja</a>:</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">pauza = 0;
broj = 1000000001;
zadnji = 1000000001;

periodicki_ispis () {
   ispisi ( zadnji );
}

postavi_pauzu () {
   pauza = 1 - pauza;
}

prekini () {
   ispisi ( zadnji );
   izadji_iz_programa ();
}

glavna_funkcija () {
   povezi_signale_s_funkcijama; // na signal SIGTERM pozovi funkciju prekini()
   postavi_periodicki_alarm;    // svakih 5 sekundi pozovi funkciju periodicki_ispis();

   ponavljaj {
      ako je ( prost ( broj ) == DA )
         zadnji = broj;
      broj++;
      dok je ( pauza == 1 )
         pauziraj ();
   }
}

/* sa kill -SIGINT/SIGTERM/SIGSTOP/SIGCONT pid ispitati rad */
</pre>
<span style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">
Provjera je li broj prost može se obaviti jednostavnim kodom, npr. prema:</span><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">int prost ( unsigned long n ) {
	unsigned long i, max;

	if ( ( n &amp; 1 ) == 0 ) /* je li paran? */
		return 0;

	max = sqrt ( n );
	for ( i = 3; i &lt;= max; i += 2 )
		if ( ( n % i ) == 0 )
			return 0;

	return 1; /* broj je prost! */
}
</pre>
<span style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">
Primjer kako bi trebao izgledati ispis programa (ako se izvorna datoteka zove 
lab1.c):</span><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">$ gcc lab1.c -lm -o lab1
$ ./lab1
zadnji prosti broj = 1000139111
zadnji prosti broj = 1000279801
zadnji prosti broj = 1000420261
^Czadnji prosti broj = 1000478719    (stisnut Ctrl+C)
zadnji prosti broj = 1000478719
zadnji prosti broj = 1000478719      (stisnut [Ctrl]+[\] tj. [Ctrl]+[Ž])
^\Quit (core dumped)
$
<span style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">(Tekst u zagradama ne ispisuje program veæ se samo opisuju korisnikove radnje.)</span></pre>
<span style="font-family: Times New Roman; font-size: medium; letter-spacing: normal; font-weight: 700">
Primjer periodièke obrade</span><p>
<span style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">
Mnoge operacije na UNIX sustavima se oslanjaju na signale. Primjerice, jedan od 
naèina periodièke obrade može se ostvariti korištenjem signala, ne izravno veæ 
korištenjem suèelja koje periodièki šalje signal procesu, a na koji se može 
pozvati potrebna funkcija.</span></p>
<p style="color: rgb(0, 0, 0); font-family: &#39;Times New Roman&#39;; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
Iduæi primjer,<span class="Apple-converted-space">&nbsp;</span><a href="http://www.zemris.fer.hr/~leonardo/os/phy/labosi/upute/lab1/itimer_primjer.c">itimer_primjer.c</a>, 
prikazuje takav program.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">#include &lt;stdio.h&gt;
#include &lt;signal.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/time.h&gt;

void periodicki_posao ( int sig )
{
	printf ( "Radim periodicki posao\n" );
}

int main ()
{
	struct itimerval t;

	/* povezivanje obrade signala SIGALRM sa funkcijom "periodicki_posao" */
	sigset ( SIGALRM, periodicki_posao );

	/* definiranje periodièkog slanja signala */
	/* prvi puta nakon: */
	t.it_value.tv_sec = 0;
	t.it_value.tv_usec = 500000;
	/* nakon prvog puta, periodicki sa periodom: */
	t.it_interval.tv_sec = 0;
	t.it_interval.tv_usec = 500000;

	/* pokretanje sata s pridruženim slanjem signala prema "t" */
	setitimer ( ITIMER_REAL, &amp;t, NULL );

	while (1)
		pause (); /* pauzira do primitka bilo kojeg signala */

	return 0;
}

/* prevodjenje i pokretanje:
 * $ gcc itimer_primjer.c -o itimer_primjer
 * $ ./itimer_primjer
 * Radim periodicki posao
 * Radim periodicki posao
 * Radim periodicki posao
 * ...
 * ^C
 * (Ctrl+C prekida izvodjenje)
 *
 * isprobati pokrenuti te s naredbom kill mu poslati signale:
 * - SIGINT, SIGTERM, SIGKILL, SIGSTOP, SIGCONT
 *
 * npr. nakon pokretanja, u drugoj konzoli napraviti:
 * $ ps -a
 * PID  TTY          TIME CMD
 * 3232 pts/0    00:00:00 itimer_primjer
 * 3233 pts/6    00:00:00 ps
 * $ kill -SIGTERM 3232
 * u prvoj konzoli æe program biti prekinut s porukom "Terminated"
 */
</pre>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">&nbsp;</pre>



</body></html>